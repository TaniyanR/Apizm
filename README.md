# Apizm（アピズム）

外部サイトを集約し、表示・ランキング・優遇・不正対策を行う高性能アンテナシステム。

超高性能アンテナサイトシステム「Apizm」は、外部サイトのRSSを集約し、新着／おすすめ／人気／ランキング表示を行い、不正アクセス検知や優遇枠などの高度な運用機能を備えています。

Apizmは完全独立型のアンテナシステムであり、複数のサーバー／ドメインで個別運用が可能です。各インスタンスはデータベース、設定、カテゴリ、優遇、広告、運用データを共有せず独立します。

PHP + MySQL で動作し、Cron を使わずタイマー方式で更新します。サイト名は管理画面から自由に設定できます。

---

## 特徴

- RSS集約（高速）
- 新着／おすすめ／人気 表示
- サイトINランキング（サイト単位）
- 人気（OUT数）集計（記事単位）
- 優遇（特別枠）表示機能
- 不正アクセス検知（保留 → 削除）
- 手動承認サイト登録
- 画像URL直リンク（保存なし）
- カテゴリ管理（最大20）
- メール通知
- 広告枠（PC/スマホ別配置）
- 固定ページ管理
- URL正規化・関連URL統合
- 設定はアップロード前にファイルで調整

---

## フロント表示仕様

### トップページ構成

新着 → おすすめ → 人気

表示比率（PC/スマホ共通）：

新着 : おすすめ : 人気 = 4 : 4 : 2

---

## 人気表示

人気はOUT数ベースで期間区切り：

- 24h（24時間）
- 7d（7日）

### PC版

トップ最下部を左右に分割：

左：24h
右：7d

### スマホ版

トップ最下部を上下に分割：

上：24h
下：7d

---

## 広告枠位置（フロント）

### PC（2枠）

1. 新着 と おすすめ の間
2. おすすめ と 人気 の間

### スマホ（3枠）

1. 新着 と おすすめ の間
2. おすすめ と 人気24h の間
3. 人気24h と 人気7d の間

未設定枠は非表示

---

## 優遇（特別枠）仕様

- 最大3サイト
- ランキング不参加
- 最低順位判定対象外
- 表示は **設定順位相当（20〜100 / 10刻み）**
- 新着・おすすめ・人気に混ざる
- カテゴリ必須
- 非公開（ウェブマスター通知なし）

---

## ランキング＆人気

### 人気（記事単位）

- OUTベース
- 期間：24h / 7d
- 優遇記事も本当に人気なら表示

### ランキング（サイト単位）

- INベース
- 期間：24h / 7d
- 優遇は対象外

---

## サイト登録と承認

### 登録項目（ユーザー）

- サイト名
- サイトURL
- RSS URL
- メールアドレス
- カテゴリ（1つ）
- 紹介記事の有無（Yes/No）
- 紹介記事の見分け方（テキスト）
- 連絡事項（任意）

### フロー

申請 → 仮登録 → 承認 → 正式登録

### 初回RSS取得

- 承認時にRSSから **直近7日分の記事** を取得
- 次の更新から表示開始

---

## カテゴリ

- 最大20
- 管理画面のみ追加可能
- 1サイト = 1カテゴリー
- 優遇もカテゴリ必須
- 登録後の変更は管理者のみ

---

## 中継ページ

OUT計測のため全記事リンクは中継ページ経由：

アンテナ → 中継ページ（OUT計測）→ 記事URL

---

## RSS出力

提供RSS：

- 総合
- カテゴリ
- 人気（24h / 7d）

含む項目：

タイトル
URL
サイト名
カテゴリ
画像URL（直URL）
公開日時

本文抜粋は含めない  
本体画面には画像を表示しない

---

## 画像

- 保存しない
- RSS内画像URLをそのまま利用
- RSSでは画像URLを出力
- 本体画面では非表示

---

## 不正アクセス検知

- INログベース
- 期間：24h / 7d
- 空refererは一定割合まで正常扱い
- 登録外参照元URLを一覧化

状態遷移：

通常 → 保留 → 削除（BAN）

削除時：

- サイト削除
- 全記事削除
- 優遇解除
- お知らせページに理由表示

理由：

理由なし
サイト更新停止
サイト削除
不正アクセスの疑い

---

## 固定ページ

- 個人情報保護
- お問い合わせ
- ユーザー登録案内
- ウェブマスター向け
- 登録/削除お知らせ

---

## 管理画面

- サイト申請管理
- サイト一覧
- 優遇サイト管理
- カテゴリ管理
- 記事一覧 / 保留一覧
- 不正疑い一覧
- 登録外参照元一覧
- 表示設定
- 基本設定（サイト名）
- 広告設定（PC/スマホ別）
- タグ挿入（head / body上 / body下）
- メール設定
- 固定ページ編集

---

## 技術仕様

- PHP
- MySQL
- Cron不要（タイマー更新）
- 完全独立型運用
- URL正規化・関連付け対応
- UP前に設定ファイル編集
- デザインは最後に設定
